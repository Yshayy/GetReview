<html>
<head>
  <title>GetReview - notifier</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="reviewstatus.css">
</head>
    <body style="padding:0;margin:0;overflow:hidden">
    <div id="close" style="background-color:red;width:16px;height:16px;position:absolute;top:0;right:0"></div>
    <div id="home" style="background-color:green;width:16px;height:16px;position:absolute;top:0;left:0"></div>
    <iframe id="frame" border="0" src="http://127.0.0.1:57023/#/request" style="width:800px;height:600px;" scrolling="no"></iframe>
    
        
    <script>
        function notificationsPoll()
        {
            try
            {
            var notifications =  document.querySelector("iframe").contentDocument.querySelector("#Notifications li");
            while (notifications.firstChild) {
                notifier.notify({
                      'title': 'Incoming review request',
                      'message': notifications.firstChild.textContent
                    });
                notifications.removeChild(notifications.firstChild);
            }
            }
            catch (e)
            {
            }
        }
        
        setInterval(notificationsPoll, 300);
        
        var notifier = require('node-notifier');
        
        
        var gui = require('nw.gui')
        var win = gui.Window.get();
        tray = new gui.Tray({ title: 'GetReview', icon: 'icon.png' });

          // Show window and remove tray when clicked
          tray.on('click', function() {
            win.show();
            tray = null;
          });

        document.querySelector("#close").addEventListener("click", function()
                                                          {
            
            win.hide();
        });
        
        document.querySelector("#home").addEventListener("click", function()
                                                         {
            document.querySelector("#frame").setAttribute("src","http://127.0.0.1:57023/#/request");
        });
  </script>
    </body>
</html>
